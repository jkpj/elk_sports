<%= content_for(:title, "#{@series.race.name} - #{@series.name}") %>
<h2>Sarjan asetukset</h2>
<div class="change_series">
  <div class="menu_and_button">
    <%= render :partial => 'shared/series_selection',
      :locals => { :url => official_change_series_path, :race => @series.race,
      :selected_id => params[:id] } %>
  </div>
</div>
<div class="action_box">
  <%= render :partial => "shared/form_errors", :locals => { :item => @series } %>
  <%= flash_error %>
  <%= flash_notice %>
  <%= form_for [:official, @series] do |f| %>
    <%= render :partial => 'official/series/form_basic_fields', :locals => { :f => f,
      :race => @series.race } %>
    <%= submit_tag "Päivitä sarjan asetukset" %>
  <% end %>
</div>
<% unless @series.competitors.empty? %>
  <% if @series.first_number and @series.start_time %>
    <div class="action_box">
      <%= form_for([:official, @series], :url => official_generate_numbers_path(@series)) do |f| %>
        <%= submit_tag "Lisää kilpailijoille lähtönumerot" %> alkaen sarjan
        ensimmäisestä numerosta (<%= @series.first_number %>).
        <a class="help" id="generate_numbers_help_link">?</a>
        <div id="generate_numbers_help_dialog" class="dialog" style="display: none;">
          Voit luoda tämän sarjan kilpailijoille lähtönumerot helposti painamalla
          'Lisää kilpailijoille lähtönumerot'-nappia. Ensimmäisen kilpailijan numeroksi
          tulee se, jonka olet määrittänyt koko sarjan ensimmäiseksi numeroksi
          tämän sivun ylälaidassa.
          <p>Jos jollakin kilpailijalla on jo numero, napin painaminen ylikirjoittaa sen.</p>
          <p>Mikäli jollekin kilpailijalle on jo syötetty tulostietoja, ei numeroita
            voi luoda enää automaattisesti, koska tämä viittaa siihen, että kilpailu on jo
            käynnissä. Mikäli sinun tarvitsee muuttaa yksittäisen kilpailijan
            numeroa, klikkaa hänen nimeään ja muuta numero avautuvalla sivulla.</p>
        </div>
        <script type="text/javascript">
          $('#generate_numbers_help_link').click(function() {
            $('#generate_numbers_help_dialog').dialog({ title: 'Lähtönumeroiden luonti',
              closeText: 'Sulje' });
          });
        </script>
      <% end %>
    </div>
    <% if @series.each_competitor_has_number? %>
      <div class="action_box">
        <%= form_for([:official, @series], :url => official_generate_times_path(@series)) do |f| %>
          <%= submit_tag "Lisää kilpailijoille lähtöajat" %> alkaen sarjan lähtöajasta
          (<%= time_print(@series.start_time) %>).
          <a class="help" id="generate_start_times_help_link">?</a>
          <div id="generate_start_times_help_dialog" class="dialog" style="display: none;">
          Voit luoda tämän sarjan kilpailijoille lähtöajat helposti painamalla
          'Lisää kilpailijoille lähtöajat'-nappia. Ensimmäisen kilpailijan lähtöajaksi
          tulee se, jonka olet määrittänyt koko sarjan lähtöajaksi
          tämän sivun ylälaidassa.
          <p>Jos jollakin kilpailijalla on jo lähtöaika, napin painaminen ylikirjoittaa sen.</p>
          <p>Mikäli jollekin kilpailijalle on jo syötetty tulostietoja, ei lähtöaikoja
            voi luoda enää automaattisesti, koska tämä viittaa siihen, että kilpailu on jo
            käynnissä. Mikäli sinun tarvitsee muuttaa yksittäisen kilpailijan
            lähtöaikaa, klikkaa hänen nimeään ja muuta aika avautuvalla sivulla.</p>
          </div>
          <script type="text/javascript">
            $('#generate_start_times_help_link').click(function() {
              $('#generate_start_times_help_dialog').dialog({ title: 'Lähtöaikojen luonti',
                closeText: 'Sulje' });
            });
          </script>
        <% end %>
      </div>
      <% if @series.each_competitor_has_start_time? %>
        <% unless @series.correct_estimate1 and @series.correct_estimate2 %>
          <%= highlight_notice('Muista syöttää oikeat arviointimatkat viimeistään ' +
              'kilpailun päätyttyä') %>
        <% end %>
      <% else %>
        <%= highlight_notice('Muista lisätä kilpailijoille lähtöajat ' +
            'yllä olevan napin avulla.') %>
      <% end %>
    <% else %>
      <%= highlight_notice('Kun olet syöttänyt kaikki kilpailijat, muista lisätä ' +
          'heille lähtönumerot yllä olevan napin avulla.') %>
    <% end %>
  <% elsif not @series.competitors.empty? %>
    <%= highlight_notice('Kun olet syöttänyt kaikki kilpailijat, ' +
        'muista syöttää sarjan ensimmäinen kilpailunumero ja lähtöaika, ' +
        'jotta kilpailijoille voidaan lisätä lähtönumerot ja lähtöajat.') %>
  <% end %>
<% end %>
<h2>Kilpailijat</h2>
<div class="action_box">
  <%= link_to "Lisää uusi kilpailija", new_official_series_competitor_path(@series.id) %>
</div>
<% if @series.competitors.empty? %>
  <%= highlight_notice('Et ole syöttänyt sarjaan vielä yhtään kilpailijaa. ' +
      'Voit lisätä heitä klikkaamalla yllä olevaa linkkiä.') %>
<% else %>
  <% if @series.each_competitor_has_start_time? %>
    <% unless @series.each_competitor_finished? %>
      <%= highlight_notice('Voit syöttää kilpailijoille tulostietoja klikkaamalla heidän ' +
          'nimessään olevaa linkkiä tai käyttäen suorituspaikkakohtaisia tulossivuja.') %>
    <% end %>
    <%= render :partial => 'official/shared/series_result_input_links',
      :locals => { :series_id => @series.id } %>
  <% end %>
  <table cellpadding="3" cellspacing="0" border="1">
    <tr>
      <th>Kilpailija</th>
      <th>Seura</th>
      <th>Nro</th>
      <th>Lähtöaika</th>
      <th>Tulos syötetty</th>
      <th>&nbsp;</th>
    </tr>
    <% @series.competitors.each do |comp| %>
      <tr id="competitor_<%= comp.id %>">
        <td>
          <%= link_to full_name(comp),
            edit_official_series_competitor_path(@series.id, comp) %>
          <%= "(#{comp.age_group.name})" if comp.age_group %>
        </td>
        <td><%= comp.club.name %></td>
        <td class="center"><%= comp.number %></td>
        <td class="center"><%= time_print(comp.start_time, true) %></td>
        <td class="center"><%= comp.finished? ? 'kyllä' : 'ei' %></td>
        <td><%= link_to "Poista", official_series_competitor_path(@series.id, comp),
            :confirm => "Haluatko varmasti poistaa tämän kilpailijan?",
            :method => :delete, :remote => true %></td>
      </tr>
    <% end %>
  </table>
<% end %>
<hr/>
<%= link_to "Takaisin toimitsijan etusivulle", official_root_path %>