<h2>Kilpailun etusivu</h2>
<%= flash_error %>
<%= flash_notice %>
<% if @race.series.empty? %>
  <%= highlight_notice('Et ole vielä lisännyt kilpailuun yhtään sarjaa. ' +
      'Lisää sarjoja alla olevasta linkistä.') %>
<% end %>
<div class="action_box">
  <%= link_to "Muokkaa kilpailun ja sarjojen asetuksia, lisää sarjoja",
    edit_official_race_path(@race) %>
</div>
<% unless @race.finished? or @race.start_date > Date.today or @race.series.empty? %>
  <div class="action_box">
    <%= render :partial => "official/finish_races/form", :locals => { :race => @race } %>
  </div>
<% end %>
<% if @race.series.empty? %>
  <div class="action_box">
    <%= form_tag(official_race_path(@race), :method => :delete) do %>
      <%= submit_tag "Poista kilpailu" %>
    <% end %>
  </div>
<% else %>
  <% if @race.competitors.empty? %>
    <%= highlight_notice('Et ole syöttänyt sarjoihin vielä yhtään kilpailijaa. ' +
        'Aloita klikkaamalla sarjan nimen vieressä olevaa linkkiä.') %>
  <% end %>
  <table cellpadding="3" cellspacing="0" border="1">
    <tr>
      <th>Sarja</th>
      <th colspan="2">Kilpailijat</th>
      <th>Lähtölista</th>
      <th colspan="4">Tulokset</th>
      <th colspan="2">Oikeat arviot</th>
      <th>Sarja valmis?</th>
      <th>&nbsp;</th>
    </tr>
    <% @race.series.each do |s| %>
      <tr>
        <td><%= s.name %></td>
        <% competitor_count = s.competitors.count %>
        <% if competitor_count > 0 %>
          <td class="center"><%= link_to t("competitors.people_short",
              :count => competitor_count), official_series_competitors_path(s) %></td>
          <td><%= link_to "Lisää", new_official_series_competitor_path(s) %></td>
          <td class="center"><%= yes_or_empty(s.has_start_list?) do
              link_to "Tee lista", official_series_start_list_path(s)
            end %></td>
          <% if s.has_start_list? %>
            <% finished_count = s.finished_competitors_count %>
            <td>
              <%= yes_or_empty(finished_count == competitor_count,
                "#{finished_count}/#{competitor_count}") do
                "#{finished_count}/#{competitor_count}"
              end %>
            </td>
            <td><%= link_to "Ajat", official_series_times_path(s) %></td>
            <td><%= link_to "Arvioinnit", official_series_estimates_path(s) %></td>
            <td><%= link_to "Ammunta", official_series_shots_path(s) %></td>
            <td class="center">
              <%= yes_or_empty(s.correct_estimate1, s.correct_estimate1) do
                link_to "Aseta", edit_official_race_path(s.race, :anchor => "series_#{s.id}")
              end %>
            </td>
            <td class="center">
              <%= yes_or_empty(s.correct_estimate2, s.correct_estimate2) do
                link_to "Aseta", edit_official_race_path(s.race, :anchor => "series_#{s.id}")
              end %>
            </td>
            <td>&nbsp;</td>
          <% else %>
            <td colspan="7">&nbsp;</td>
          <% end %>
          <td>&nbsp;</td>
        <% else %>
          <td colspan="2" class="center"><%= link_to "Lisää",
              new_official_series_competitor_path(s) %></td>
          <td colspan="8">&nbsp;</td>
          <td><%= link_to 'Poista', official_series_path(s), :method => :delete,
              :confirm => 'Haluatko varmasti poistaa tämän sarjan?' %></td>
        <% end %>
      </tr>
    <% end %>
  </table>
<% end %>
<hr/>
<%= link_to "Takaisin toimitsijan etusivulle", official_root_path %>