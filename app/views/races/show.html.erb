<%= content_for(:title, @race.name) %>
<% if @race.home_page %>
  <h2>Lisätietoa kilpailusta</h2>
  <div class="section">
    <a href="<%= link_with_protocol(@race.home_page) %>" target="_blank">Kilpailun
      kotisivut</a>
  </div>
<% end %>
<h2>Sarjat</h2>
<% if @race.series.empty? %>
  Kilpailuun ei ole vielä lisätty sarjoja
<% else %>
  <div class="section">
    <table>
      <tr>
        <th>Nimi</th>
        <th>Lähtöaika</th>
        <th>Kilpailijoita</th>
        <th>&nbsp;</th>
      </tr>
      <% @race.series.each do |s| %>
        <tr id="series_<%= s.id %>">
          <td><%= s.name %></td>
          <td>
            <% if s.start_time %>
              <%= series_datetime_print(s, true) %>
            <% else %>
              -
            <% end %>
          </td>
          <% if s.competitors.empty? %>
            <td colspan="2">Sarjaan ei ole merkitty kilpailijoita</td>
          <% else %>
            <td><%= s.competitors.count %></td>
            <td>
              <% if s.competitors.empty? %>

              <% elsif !s.has_start_list? %>
                Sarjan lähtöluetteloa ei ole vielä julkaistu
              <% else %>
                <%= link_to "Tulokset", series_competitors_path(s) %>,
                <%= link_to "Lähtölista", series_start_list_path(s) %>
              <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </table>
  </div>
  <% if @race.start_date <= Date.today %>
    <% if @race.has_team_competition? %>
      <h2>Joukkuekilpailu</h2>
      <div class="section">
        <%= link_to "Joukkuekilpailun tulokset", race_team_results_path(@race) %>
      </div>
    <% end %>
    <h2>Kaikkien sarjojen tulokset</h2>
    <div class="section">
      <%= link_to "Lataa PDF-tiedosto", race_path(@race, :format => :pdf) %>
    </div>
  <% end %>
  <% if @race.finished? %>
    <h2>Oikeat arviot</h2>
    <div class="section">
    <table>
      <tr>
        <th>Kilpailunumerot</th>
        <th>Oikea arvio 1</th>
        <th>Oikea arvio 2</th>
      </tr>
      <% @race.correct_estimates.each do |ce| %>
        <tr>
          <td class="center"><%= ce.min_number %>-<%= ce.max_number ? ce.max_number : '' %></td>
          <td class="center"><%= ce.distance1 %></td>
          <td class="center"><%= ce.distance2 %></td>
        </tr>
      <% end %>
    </table>
      </div>
  <% end %>
<% end %>
<h2>Viestit</h2>
<div class="section">
  <table>
    <tr>
      <th>Viesti</th>
      <th>Lähtöaika</th>
      <th>Joukkueita</th>
    </tr>
    <% @race.relays.each do |relay| %>
      <tr>
        <td><%= link_to relay.name, race_relay_path(@race, relay) %></td>
        <td><%= series_datetime_print relay, true if relay.start_time %></td>
        <td class="center"><%= relay.relay_teams.count %></td>
      </tr>
    <% end %>
  </table>
</div>
<% if false and @race.start_date > Date.today %>
  <div class="info">
    Kilpailun alkuun on aikaa
    <%= distance_of_time_in_words(Date.today, @race.start_date, false) %>.</div>
<% end %>
<hr/>
<%= link_to "Takaisin etusivulle", root_path %>